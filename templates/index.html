{% extends "base.html" %}
{% set active_page = "home" %}

{% block title %}upg-strings - Verified ML-guided search for Calabi-Yau targets{% endblock %}
{% block description %}Reproducible pipeline to rank and verify rare targets in Calabi-Yau datasets.{% endblock %}
{% block og_tags %}
    <meta property="og:title" content="upg-strings - Verified ML-guided search">
    <meta property="og:description" content="Reproducible pipeline to rank and verify rare targets in Calabi-Yau datasets.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://compute.upg.gr">
{% endblock %}

{% block content %}
    <header class="hero">
        <div class="container">
            <div class="badge">Verified Outputs</div>
            <h1>upg-strings</h1>
            <p class="subtitle">Verified ML-guided search for rare Calabi-Yau targets (string landscape)</p>
            <p class="tagline">We build ML-guided search tools that drastically reduce the cost of finding rare Calabi-Yau geometries in large string-theory datasets, with full verification and reproducibility.</p>
            <p class="tagline" style="font-weight: 600; color: var(--primary-color); margin-top: 1rem;">We achieve perfect precision and non-trivial recall in ML-guided search for rare targets, with sub-second runtime.</p>
            <p class="tagline" style="margin-top: 0.75rem;">Compatible with CYTools, cymetric, Sage, Mathematica, plus JSON/CSV exports.</p>
        </div>
    </header>

    <main class="container">
        <section class="section">
            <h2>Run a Search</h2>
            <p>Click the button below to run a live ML-guided search on 5,000 Calabi-Yau manifolds. Results will appear in ~5-10 seconds.</p>

            <div style="margin: 2rem 0; text-align: center;">
                <button id="run-demo-btn" class="btn btn-primary" style="font-size: 1.125rem; padding: 1rem 2rem;">
                    üöÄ Run Live Search Now
                </button>
            </div>

            <div id="demo-status" style="display: none; margin-top: 1rem; padding: 1rem; background: #f0f7ff; border-left: 4px solid var(--primary-color); border-radius: 4px;">
                <p id="status-message" style="margin: 0; font-weight: 500;"></p>
            </div>

            <div id="demo-results" style="display: none; margin-top: 2rem;">
                <h3>Search Complete!</h3>
                <div class="metrics-cards" style="margin-top: 1rem;">
                    <div class="metric-card">
                        <div class="metric-value" id="demo-precision">-</div>
                        <div class="metric-label">Precision@100</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="demo-recall">-</div>
                        <div class="metric-label">Recall@100</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="demo-runtime">-</div>
                        <div class="metric-label">Runtime</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="demo-verified">-</div>
                        <div class="metric-label">Verified Targets</div>
                    </div>
                </div>
                <p style="margin-top: 1rem; text-align: center;">
                    <a href="/results.html" class="btn btn-secondary">View Full Results</a>
                </p>
            </div>

        </section>

        <section class="section">
            <h2>For Scientists</h2>
            <p>Use upg-strings as a reproducible filter for rare geometries before deeper analysis.</p>
            <ul>
                <li>Run an ML-guided search to rank candidates by likelihood of meeting your target criteria</li>
                <li>Verify top-k hits against ground truth labels for precision and recall</li>
                <li>Export CSV/JSON artifacts for downstream calculations and publication-ready summaries</li>
                <li>Repeat with fixed seeds to compare experiments and share reproducible results</li>
            </ul>
        </section>

        <section class="section">
            <h2>Outputs</h2>
            <div class="outputs-grid">
                <div class="output-item">
                    <h3>results_topk.csv</h3>
                    <p>Top-ranked candidates with scores and verification status</p>
                </div>
                <div class="output-item">
                    <h3>metrics.json</h3>
                    <p>Performance metrics and timing data</p>
                </div>
                <div class="output-item">
                    <h3>repro.md</h3>
                    <p>Complete reproducibility report with environment details</p>
                </div>
            </div>
            <p class="note" style="margin-top: 1rem;">Compatible exports: CYTools, cymetric, Sage, Mathematica, plus JSON/CSV.</p>
            <div class="compat-row">
                <span class="compat-pill">CYTools</span>
                <span class="compat-pill">cymetric</span>
                <span class="compat-pill">Sage</span>
                <span class="compat-pill">Mathematica</span>
                <span class="compat-pill">JSON</span>
                <span class="compat-pill">CSV</span>
            </div>
        </section>

        <section class="section">
            <h2>Metrics</h2>
            <div class="metrics-grid">
                <div class="metric-item">
                    <h3>Precision@k</h3>
                    <p>Fraction of top-k predictions that are verified correct</p>
                </div>
                <div class="metric-item">
                    <h3>Recall@k</h3>
                    <p>Fraction of all true targets found in top-k results</p>
                </div>
                <div class="metric-item">
                    <h3>Time-to-First-Hit</h3>
                    <p>How quickly the first verified target is discovered</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>Links</h2>
            <div class="links-grid">
                <a href="https://github.com/upggr/compute.upg.gr" class="btn btn-primary" target="_blank" rel="noopener">
                    GitHub Repository
                </a>
                <a href="/docs.html" class="btn btn-secondary">
                    Documentation
                </a>
                <a href="/results.html" class="btn btn-secondary">
                    Latest Run Artifacts
                </a>
            </div>
        </section>

        <section class="section disclaimer">
            <p><strong>Disclaimer:</strong> This tool accelerates computational search and verification. It does not claim to 'solve string theory'.</p>
        </section>
    </main>
{% endblock %}

{% block scripts %}
    <script>
    document.getElementById('run-demo-btn').addEventListener('click', async function() {
        const btn = this;
        const statusDiv = document.getElementById('demo-status');
        const resultsDiv = document.getElementById('demo-results');
        const statusMsg = document.getElementById('status-message');

        // Disable button
        btn.disabled = true;
        btn.textContent = '‚è≥ Running search...';

        // Show status
        statusDiv.style.display = 'block';
        resultsDiv.style.display = 'none';
        statusMsg.textContent = 'Initializing ML-guided search on 5,000 Calabi-Yau manifolds...';

        try {
            const response = await fetch('/api/run-demo', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    top_k: 100,
                    seed: 42,
                    n_candidates: 5000,
                    verify: true,
                    use_real: true
                })
            });

            const data = await response.json();

            if (data.status === 'success') {
                // Show results
                const metrics = data.results.performance_metrics;
                const timing = data.results.timing;

                document.getElementById('demo-precision').textContent =
                    (metrics.precision_at_k * 100).toFixed(1) + '%';
                document.getElementById('demo-recall').textContent =
                    (metrics.recall_at_k * 100).toFixed(1) + '%';
                document.getElementById('demo-runtime').textContent =
                    timing.total_runtime_seconds.toFixed(1) + 's';
                document.getElementById('demo-verified').textContent =
                    metrics.verified_count + '/100';

                statusDiv.style.display = 'none';
                resultsDiv.style.display = 'block';
                btn.textContent = '‚úì Search Complete!';
            } else {
                statusMsg.textContent = 'Error: ' + (data.message || 'Unknown error');
                btn.disabled = false;
                    btn.textContent = 'üöÄ Run Live Search Now';
            }
        } catch (error) {
            statusMsg.textContent = 'Error: ' + error.message;
            btn.disabled = false;
                btn.textContent = 'üöÄ Run Live Search Now';
        }
    });
    </script>
{% endblock %}
